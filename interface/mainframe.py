import json

import wx
import pygame

import img

black = pygame.surface.Surface((120, 120))
black.fill(0x000000)

def make_preview(item):
    x, y, w, h = item["x"], item["y"], item["w"], item["h"]
    surf = black.copy()

    itemblock = pygame.surface.Surface((w*10, h*10))
    itemblock.fill(0xFF0000)

    surf.blit(itemblock, (x*10, y*10))

    return surf

class Main(wx.Frame):
    def __init__(self, _app, position, size):
        self._app = _app
        wx.Frame.__init__(self, parent = None, id = wx.ID_ANY, title = u"What are the chances?", pos = position, size = size, style = wx.DEFAULT_FRAME_STYLE | wx.TAB_TRAVERSAL)
        
        self.SetSizeHintsSz(wx.DefaultSize, wx.DefaultSize)
        
        sizer_bg = wx.BoxSizer(wx.VERTICAL)
        
        self.panel_bg = wx.Panel(self, wx.ID_ANY, wx.DefaultPosition, wx.DefaultSize, wx.TAB_TRAVERSAL)
        self.panel_bg.SetBackgroundColour(wx.SystemSettings.GetColour(wx.SYS_COLOUR_WINDOW))
        
        sizer_main = wx.BoxSizer(wx.HORIZONTAL)
        
        self.tree_inventories = wx.TreeCtrl(self.panel_bg, wx.ID_ANY, wx.DefaultPosition, wx.Size(-1,600), wx.TR_DEFAULT_STYLE|wx.TR_HIDE_ROOT)
        self.tree_inventories.SetQuickBestSize(False)

        self.tree_inventories.rootid = self.tree_inventories.AddRoot("root")
        self.tree_inventories.SetMinSize((250, -1))

        sizer_main.Add(self.tree_inventories, 0, wx.ALL | wx.EXPAND, 5)
        
        
        sizer_main.AddSpacer((0, 0), 1, wx.EXPAND, 5)
        
        self.panel_items = wx.Panel(self.panel_bg, wx.ID_ANY, wx.DefaultPosition, wx.DefaultSize, wx.TAB_TRAVERSAL)
        grid_items = wx.GridSizer(0, 6, 0, 0)
        
        self.previews = [[None for _ in xrange(3)] for __ in xrange(6)]
        for y in xrange(3):
            col = []
            for x in xrange(6):
                preview = {}
                preview["sizer"] = wx.StaticBoxSizer(wx.StaticBox(self.panel_items, wx.ID_ANY, " "), wx.VERTICAL)
                panel = wx.Panel(self.panel_items, wx.ID_ANY, wx.DefaultPosition, wx.DefaultSize, wx.SUNKEN_BORDER | wx.TAB_TRAVERSAL)
                sizer = wx.BoxSizer(wx.VERTICAL)
                preview["bitmap"] = wx.StaticBitmap(panel, wx.ID_ANY, wx.NullBitmap, wx.DefaultPosition, wx.Size(120, 120), 0)
                img.show_pygame_surf_in_wxBitmap(black, preview["bitmap"])
                sizer.Add(preview["bitmap"], 0, 0, 5)
                panel.SetSizer(sizer)
                panel.Layout()
                sizer.Fit(panel)
                preview["sizer"].Add(panel, 1, wx.EXPAND | wx.ALL, 5)
                grid_items.Add(preview["sizer"], 0, 0, 5)
                
                self.previews[x][y] = preview

        self.panel_items.SetSizer(grid_items)
        self.panel_items.Layout()
        grid_items.Fit(self.panel_items)
        sizer_main.Add(self.panel_items, 0, wx.ALL | wx.ALIGN_CENTER_VERTICAL, 5)
        
        
        sizer_main.AddSpacer((0, 0), 1, wx.EXPAND, 5)
        
        
        self.panel_bg.SetSizer(sizer_main)
        self.panel_bg.Layout()
        sizer_main.Fit(self.panel_bg)
        sizer_bg.Add(self.panel_bg, 1, wx.EXPAND, 5)
        
        
        self.SetSizer(sizer_bg)
        self.Layout()

        self.setbinds()
        self.update_inventories()
        self.Show()

    def setbinds(self):
        self.Bind(wx.EVT_CLOSE, self._on_close)
        self.tree_inventories.Bind(wx.EVT_TREE_SEL_CHANGED, 
                               self._on_inventory_selected)

    def _on_close(self, event):
        x, y = self.GetPosition()
        w, h = self.GetSize()
        self._app.mainframe_closed(x, y, w, h)
        event.Skip()

    def _on_inventory_selected(self, event):
        #<There must be a better way
        inventoryid = self.tree_inventories.GetSelection()
        label = self.tree_inventories.GetItemText(inventoryid)
        if not label.startswith("Inventory"):
            inventoryid = self.tree_inventories.GetItemParent(inventoryid)
            label = self.tree_inventories.GetItemText(inventoryid)
        index = int(label.split()[-1]) - 1
        #>

        self.clear_previews()

        x = 0
        y = 0
        for item in self.inventories[index]:
            preview = self.previews[x][y]
            preview["sizer"].StaticBox.SetLabel(item["_tab_label"])
            surf_preview = make_preview(item)
            img.show_pygame_surf_in_wxBitmap(surf_preview,
                                                preview["bitmap"])

            x += 1
            if x == 6:
                x = 0
                y += 1

    def update_inventories(self):
        #inventories = [[{u'socketedItems': [], u'corrupted': False, u'typeLine': u'Imbued Wand', u'implicitMods': [u'16% increased Spell Damage'], u'sockets': [{u'group': 0, u'attr': u'D'}, {u'group': 0, u'attr': u'I'}], u'lockedToCharacter': False, u'verified': False, u'support': True, u'frameType': 2, u'explicitMods': [u'8% increased Spell Damage', u'Adds 24-46 Cold Damage to Spells', u'+8 to maximum Mana', u'+5 Life gained for each Enemy hit by Attacks', u'+232 to Accuracy Rating'], u'_type': 0, u'_socketed': False, u'inventoryId': u'Stash31', u'requirements': [{u'displayMode': 0, u'values': [[u'59', 0]], u'name': u'Level'}, {u'displayMode': 1, u'values': [[u'188', 0]], u'name': u'Int'}], u'properties': [{u'displayMode': 0, u'values': [], u'name': u'Wand'}, {u'displayMode': 0, u'values': [[u'20-38', 0]], u'name': u'Physical Damage'}, {u'displayMode': 0, u'values': [[u'8.00%', 0]], u'name': u'Critical Strike Chance'}, {u'displayMode': 0, u'values': [[u'1.50', 0]], u'name': u'Attacks per Second'}], u'icon': u'https://p7p4m6s5.ssl.hwcdn.net/image/Art/2DItems/Weapons/OneHandWeapons/Wands/Wand3.png?scale=1&w=1&h=3&v=ac9f7eee09f5a8f580151298712f2a9e3', 'count': 2, u'league': u'Tempest', u'name': u'Golem Bite', u'_tab': 30, u'h': 3, u'identified': True, u'w': 1, u'_tab_label': u'2', u'y': 6, u'x': 8}, {u'socketedItems': [], u'corrupted': False, u'typeLine': u'Wraith Axe', u'sockets': [{u'group': 0, u'attr': u'D'}, {u'group': 0, u'attr': u'S'}], u'lockedToCharacter': False, u'verified': False, u'support': True, u'frameType': 2, u'explicitMods': [u'Adds 42-73 Fire Damage', u'Adds 10-21 Cold Damage', u'Adds 3-61 Lightning Damage', u'9% reduced Enemy Stun Threshold', u'+31% to Fire Resistance', u'+11 Life gained on Kill'], u'_type': 0, u'_socketed': False, u'inventoryId': u'Stash37', u'requirements': [{u'displayMode': 0, u'values': [[u'54', 0]], u'name': u'Level'}, {u'displayMode': 1, u'values': [[u'134', 0]], u'name': u'Str'}, {u'displayMode': 1, u'values': [[u'59', 0]], u'name': u'Dex'}], u'properties': [{u'displayMode': 0, u'values': [], u'name': u'One Handed Axe'}, {u'displayMode': 0, u'values': [[u'39-65', 0]], u'name': u'Physical Damage'}, {u'displayMode': 0, u'values': [[u'42-73', 4], [u'10-21', 5], [u'3-61', 6]], u'name': u'Elemental Damage'}, {u'displayMode': 0, u'values': [[u'5.00%', 0]], u'name': u'Critical Strike Chance'}, {u'displayMode': 0, u'values': [[u'1.30', 0]], u'name': u'Attacks per Second'}], u'icon': u'https://p7p4m6s5.ssl.hwcdn.net/image/Art/2DItems/Weapons/OneHandWeapons/OneHandAxes/OneHandAxe8.png?scale=1&w=2&h=3&v=855efb67597b11eae4c7bf175d2dae5f3', 'count': 2, u'league': u'Tempest', u'name': u'Golem Bite', u'_tab': 36, u'h': 3, u'identified': True, u'w': 2, u'_tab_label': u'8', u'y': 6, u'x': 6}, {u'socketedItems': [], u'corrupted': False, u'typeLine': u'Corsair Sword', u'implicitMods': [u'18% increased Accuracy Rating'], u'sockets': [{u'group': 0, u'attr': u'D'}, {u'group': 0, u'attr': u'D'}, {u'group': 1, u'attr': u'S'}], u'lockedToCharacter': False, u'verified': False, u'support': True, u'frameType': 2, u'explicitMods': [u'+30 to Dexterity', u'Adds 24-48 Cold Damage', u'10% reduced Enemy Stun Threshold', u'+8 Life gained on Kill'], u'_type': 0, u'_socketed': False, u'inventoryId': u'Stash40', u'requirements': [{u'displayMode': 0, u'values': [[u'58', 0]], u'name': u'Level'}, {u'displayMode': 1, u'values': [[u'81', 0]], u'name': u'Str'}, {u'displayMode': 1, u'values': [[u'117', 0]], u'name': u'Dex'}], u'properties': [{u'displayMode': 0, u'values': [], u'name': u'One Handed Sword'}, {u'displayMode': 0, u'values': [[u'+10%', 1]], u'name': u'Quality'}, {u'displayMode': 0, u'values': [[u'18-69', 1]], u'name': u'Physical Damage'}, {u'displayMode': 0, u'values': [[u'24-48', 5]], u'name': u'Elemental Damage'}, {u'displayMode': 0, u'values': [[u'5.00%', 0]], u'name': u'Critical Strike Chance'}, {u'displayMode': 0, u'values': [[u'1.55', 0]], u'name': u'Attacks per Second'}], u'icon': u'https://p7p4m6s5.ssl.hwcdn.net/image/Art/2DItems/Weapons/OneHandWeapons/OneHandSwords/OneHandSword3.png?scale=1&w=1&h=3&v=0bf4b174a0c80b2fd80a12026ed04a053', 'count': 2, u'league': u'Tempest', u'name': u'Apocalypse Spiker', u'_tab': 39, u'h': 3, u'identified': True, u'w': 1, u'_tab_label': u'11', u'y': 3, u'x': 9}, {u'socketedItems': [], u'corrupted': False, u'typeLine': u"Headman's Sword", u'implicitMods': [u'18% increased Accuracy Rating'], u'sockets': [{u'group': 0, u'attr': u'D'}], u'lockedToCharacter': False, u'verified': False, u'support': True, u'frameType': 2, u'explicitMods': [u'21% increased Elemental Damage with Weapons', u'+39 to Strength', u'Adds 8-111 Lightning Damage', u'8% reduced Enemy Stun Threshold'], u'_type': 0, u'_socketed': False, u'inventoryId': u'Stash40', u'requirements': [{u'displayMode': 0, u'values': [[u'57', 0]], u'name': u'Level'}, {u'displayMode': 1, u'values': [[u'106', 0]], u'name': u'Str'}, {u'displayMode': 1, u'values': [[u'89', 0]], u'name': u'Dex'}], u'properties': [{u'displayMode': 0, u'values': [], u'name': u'Two Handed Sword'}, {u'displayMode': 0, u'values': [[u'52-122', 0]], u'name': u'Physical Damage'}, {u'displayMode': 0, u'values': [[u'8-111', 6]], u'name': u'Elemental Damage'}, {u'displayMode': 0, u'values': [[u'5.00%', 0]], u'name': u'Critical Strike Chance'}, {u'displayMode': 0, u'values': [[u'1.20', 0]], u'name': u'Attacks per Second'}], u'icon': u'https://p7p4m6s5.ssl.hwcdn.net/image/Art/2DItems/Weapons/TwoHandWeapons/TwoHandSwords/TwoHandSword2.png?scale=1&w=2&h=4&v=c6eb2632cbcdf26da86bc4c2db397e7d3', 'count': 2, u'league': u'Tempest', u'name': u'Dread Bane', u'_tab': 39, u'h': 4, u'identified': True, u'w': 2, u'_tab_label': u'11', u'y': 8, u'x': 0}, {u'socketedItems': [], u'corrupted': False, u'typeLine': u'Carnal Sceptre', u'implicitMods': [u'10% increased Elemental Damage'], u'sockets': [{u'group': 0, u'attr': u'S'}, {u'group': 0, u'attr': u'I'}, {u'group': 1, u'attr': u'I'}], u'lockedToCharacter': False, u'verified': False, u'support': True, u'frameType': 2, u'explicitMods': [u'Adds 14-25 Physical Damage', u'+14 to Intelligence', u'Adds 16-31 Cold Damage', u'5% increased Attack Speed', u'14% increased Stun Duration on Enemies'], u'_type': 0, u'_socketed': False, u'inventoryId': u'Stash45', u'requirements': [{u'displayMode': 0, u'values': [[u'66', 0]], u'name': u'Level'}, {u'displayMode': 1, u'values': [[u'113', 0]], u'name': u'Str'}, {u'displayMode': 1, u'values': [[u'113', 0]], u'name': u'Int'}], u'properties': [{u'displayMode': 0, u'values': [], u'name': u'One Handed Mace'}, {u'displayMode': 0, u'values': [[u'48-103', 1]], u'name': u'Physical Damage'}, {u'displayMode': 0, u'values': [[u'16-31', 5]], u'name': u'Elemental Damage'}, {u'displayMode': 0, u'values': [[u'6.00%', 0]], u'name': u'Critical Strike Chance'}, {u'displayMode': 0, u'values': [[u'1.26', 1]], u'name': u'Attacks per Second'}], u'icon': u'https://p7p4m6s5.ssl.hwcdn.net/image/Art/2DItems/Weapons/OneHandWeapons/Scepters/scepter7.png?scale=1&w=2&h=3&v=61c3ccc0753b40f6be18d994a88014533', 'count': 2, u'league': u'Tempest', u'name': u'Hypnotic Grinder', u'_tab': 44, u'h': 3, u'identified': True, u'w': 2, u'_tab_label': u'16', u'y': 0, u'x': 10}, {u'socketedItems': [], u'corrupted': False, u'typeLine': u'Eagle Claw', u'implicitMods': [u'2% of Physical Attack Damage Leeched as Life'], u'sockets': [{u'group': 0, u'attr': u'I'}, {u'group': 0, u'attr': u'I'}], u'lockedToCharacter': False, u'verified': False, u'support': True, u'frameType': 2, u'explicitMods': [u'+2 to Level of Socketed Melee Gems', u'25% increased Attack Speed', u'+101 to Accuracy Rating', u'5% increased Light Radius'], u'_type': 0, u'_socketed': False, u'inventoryId': u'Stash52', u'requirements': [{u'displayMode': 0, u'values': [[u'55', 0]], u'name': u'Level'}, {u'displayMode': 1, u'values': [[u'94', 0]], u'name': u'Dex'}, {u'displayMode': 1, u'values': [[u'94', 0]], u'name': u'Int'}], u'properties': [{u'displayMode': 0, u'values': [], u'name': u'Claw'}, {u'displayMode': 0, u'values': [[u'14-56', 0]], u'name': u'Physical Damage'}, {u'displayMode': 0, u'values': [[u'6.30%', 0]], u'name': u'Critical Strike Chance'}, {u'displayMode': 0, u'values': [[u'1.88', 1]], u'name': u'Attacks per Second'}], u'icon': u'https://p7p4m6s5.ssl.hwcdn.net/image/Art/2DItems/Weapons/OneHandWeapons/Claws/Claw8.png?scale=1&w=2&h=2&v=3e3a81e6e64ee3e493db6a417de6dc363', 'count': 2, u'league': u'Tempest', u'name': u'Dread Bane', u'_tab': 51, u'h': 2, u'identified': True, u'w': 2, u'_tab_label': u'23', u'y': 6, u'x': 8}, {u'socketedItems': [], u'corrupted': False, u'typeLine': u'Tenderizer', u'implicitMods': [u'20% increased Stun Duration on Enemies'], u'sockets': [{u'group': 0, u'attr': u'S'}, {u'group': 0, u'attr': u'S'}], u'lockedToCharacter': False, u'verified': False, u'support': True, u'frameType': 2, u'explicitMods': [u'+2 to Level of Socketed Melee Gems', u'+36 to Strength', u'Adds 24-49 Fire Damage', u'13% increased Attack Speed'], u'_type': 0, u'_socketed': False, u'inventoryId': u'Stash71', u'requirements': [{u'displayMode': 0, u'values': [[u'58', 0]], u'name': u'Level'}, {u'displayMode': 1, u'values': [[u'185', 0]], u'name': u'Str'}], u'properties': [{u'displayMode': 0, u'values': [], u'name': u'One Handed Mace'}, {u'displayMode': 0, u'values': [[u'38-49', 0]], u'name': u'Physical Damage'}, {u'displayMode': 0, u'values': [[u'24-49', 4]], u'name': u'Elemental Damage'}, {u'displayMode': 0, u'values': [[u'5.00%', 0]], u'name': u'Critical Strike Chance'}, {u'displayMode': 0, u'values': [[u'1.58', 1]], u'name': u'Attacks per Second'}], u'icon': u'https://p7p4m6s5.ssl.hwcdn.net/image/Art/2DItems/Weapons/OneHandWeapons/OneHandMaces/OneHandMace3.png?scale=1&w=1&h=3&v=0da211513b53dc8acc1a040ee18b63473', 'count': 2, u'league': u'Tempest', u'name': u'Hypnotic Grinder', u'_tab': 70, u'h': 3, u'identified': True, u'w': 1, u'_tab_label': u'42', u'y': 0, u'x': 3}, {u'socketedItems': [], u'corrupted': False, u'typeLine': u"Headman's Sword", u'implicitMods': [u'18% increased Accuracy Rating'], u'sockets': [{u'group': 0, u'attr': u'D'}, {u'group': 1, u'attr': u'D'}], u'lockedToCharacter': False, u'verified': False, u'support': True, u'frameType': 2, u'explicitMods': [u'16% increased Physical Damage', u'Adds 40-71 Fire Damage', u'Adds 12-19 Cold Damage', u'+20% to Fire Resistance', u'+5 to Accuracy Rating'], u'_type': 0, u'_socketed': False, u'inventoryId': u'Stash83', u'requirements': [{u'displayMode': 0, u'values': [[u'57', 0]], u'name': u'Level'}, {u'displayMode': 1, u'values': [[u'106', 0]], u'name': u'Str'}, {u'displayMode': 1, u'values': [[u'89', 0]], u'name': u'Dex'}], u'properties': [{u'displayMode': 0, u'values': [], u'name': u'Two Handed Sword'}, {u'displayMode': 0, u'values': [[u'60-142', 1]], u'name': u'Physical Damage'}, {u'displayMode': 0, u'values': [[u'40-71', 4], [u'12-19', 5]], u'name': u'Elemental Damage'}, {u'displayMode': 0, u'values': [[u'5.00%', 0]], u'name': u'Critical Strike Chance'}, {u'displayMode': 0, u'values': [[u'1.20', 0]], u'name': u'Attacks per Second'}], u'icon': u'https://p7p4m6s5.ssl.hwcdn.net/image/Art/2DItems/Weapons/TwoHandWeapons/TwoHandSwords/TwoHandSword2.png?scale=1&w=2&h=4&v=c6eb2632cbcdf26da86bc4c2db397e7d3', 'count': 2, u'league': u'Tempest', u'name': u'Apocalypse Spiker', u'_tab': 82, u'h': 4, u'identified': True, u'w': 2, u'_tab_label': u'54', u'y': 4, u'x': 0}], [{u'socketedItems': [], u'corrupted': False, u'typeLine': u'Sharkskin Tunic', u'sockets': [{u'group': 0, u'attr': u'D'}, {u'group': 0, u'attr': u'D'}, {u'group': 0, u'attr': u'D'}], u'lockedToCharacter': False, u'verified': False, u'support': True, u'frameType': 2, u'explicitMods': [u'+27 to Dexterity', u'28% increased Evasion Rating', u'+31% to Cold Resistance', u'19% increased Stun Recovery'], u'_type': 0, u'_socketed': False, u'inventoryId': u'Stash31', u'requirements': [{u'displayMode': 0, u'values': [[u'56', 0]], u'name': u'Level'}, {u'displayMode': 1, u'values': [[u'152', 0]], u'name': u'Dex'}], u'properties': [{u'displayMode': 0, u'values': [[u'511', 1]], u'name': u'Evasion Rating'}], u'icon': u'https://p7p4m6s5.ssl.hwcdn.net/image/Art/2DItems/Armours/BodyArmours/BodyDex1B.png?scale=1&w=2&h=3&v=6c54a5109d16d454488c1d342c00154e3', 'count': 2, u'league': u'Tempest', u'name': u'Victory Sanctuary', u'_tab': 30, u'h': 3, u'identified': True, u'w': 2, u'_tab_label': u'2', u'y': 0, u'x': 8}, {u'socketedItems': [], u'corrupted': False, u'typeLine': u'Sentinel Jacket', u'sockets': [{u'group': 0, u'attr': u'D'}, {u'group': 0, u'attr': u'D'}, {u'group': 0, u'attr': u'D'}], u'lockedToCharacter': False, u'verified': False, u'support': True, u'frameType': 2, u'explicitMods': [u'+28 to Intelligence', u'53% increased Evasion and Energy Shield', u'+102 to maximum Energy Shield', u'Reflects 4 Physical Damage to Melee Attackers'], u'_type': 0, u'_socketed': False, u'inventoryId': u'Stash58', u'requirements': [{u'displayMode': 0, u'values': [[u'59', 0]], u'name': u'Level'}, {u'displayMode': 1, u'values': [[u'86', 0]], u'name': u'Dex'}, {u'displayMode': 1, u'values': [[u'86', 0]], u'name': u'Int'}], u'properties': [{u'displayMode': 0, u'values': [[u'360', 1]], u'name': u'Evasion Rating'}, {u'displayMode': 0, u'values': [[u'262', 1]], u'name': u'Energy Shield'}], u'icon': u'https://p7p4m6s5.ssl.hwcdn.net/image/Art/2DItems/Armours/BodyArmours/BodyDexInt1B.png?scale=1&w=2&h=3&v=9e72d3b4ad8744fcd79007e4bba8d5db3', 'count': 2, u'league': u'Tempest', u'name': u'Victory Sanctuary', u'_tab': 57, u'h': 3, u'identified': True, u'w': 2, u'_tab_label': u'29', u'y': 9, u'x': 6}, {u'socketedItems': [], u'corrupted': False, u'typeLine': u'Eye Gouger', u'implicitMods': [u'+31 Life gained for each Enemy hit by Attacks'], u'sockets': [{u'group': 0, u'attr': u'I'}, {u'group': 1, u'attr': u'D'}], u'lockedToCharacter': False, u'verified': False, u'support': True, u'frameType': 2, u'explicitMods': [u'+29 to Intelligence', u'Adds 33-56 Fire Damage', u'Adds 3-92 Lightning Damage', u'+17 to maximum Mana', u'+1 Mana Gained on Kill'], u'_type': 0, u'_socketed': False, u'inventoryId': u'Stash59', u'requirements': [{u'displayMode': 0, u'values': [[u'64', 0]], u'name': u'Level'}, {u'displayMode': 1, u'values': [[u'113', 0]], u'name': u'Dex'}, {u'displayMode': 1, u'values': [[u'113', 0]], u'name': u'Int'}], u'properties': [{u'displayMode': 0, u'values': [], u'name': u'Claw'}, {u'displayMode': 0, u'values': [[u'23-61', 0]], u'name': u'Physical Damage'}, {u'displayMode': 0, u'values': [[u'33-56', 4], [u'3-92', 6]], u'name': u'Elemental Damage'}, {u'displayMode': 0, u'values': [[u'6.30%', 0]], u'name': u'Critical Strike Chance'}, {u'displayMode': 0, u'values': [[u'1.50', 0]], u'name': u'Attacks per Second'}], u'icon': u'https://p7p4m6s5.ssl.hwcdn.net/image/Art/2DItems/Weapons/OneHandWeapons/Claws/Claw5.png?scale=1&w=2&h=2&v=6296317967fe7c1a41c81f74f6b6cc893', 'count': 2, u'league': u'Tempest', u'name': u'Hate Barb', u'_tab': 58, u'h': 2, u'identified': True, u'w': 2, u'_tab_label': u'30', u'y': 7, u'x': 2}, {u'socketedItems': [], u'corrupted': False, u'typeLine': u'Imperial Claw', u'implicitMods': [u'+25 Life gained for each Enemy hit by Attacks'], u'sockets': [{u'group': 0, u'attr': u'D'}, {u'group': 0, u'attr': u'I'}, {u'group': 1, u'attr': u'D'}], u'lockedToCharacter': False, u'verified': False, u'support': True, u'frameType': 2, u'explicitMods': [u'Adds 4-9 Physical Damage', u'Adds 2-3 Fire Damage', u'30% increased Global Critical Strike Multiplier', u'+13 Life gained on Kill', u'+1 Mana Gained on Kill'], u'_type': 0, u'_socketed': False, u'inventoryId': u'Stash68', u'requirements': [{u'displayMode': 0, u'values': [[u'68', 0]], u'name': u'Level'}, {u'displayMode': 1, u'values': [[u'131', 0]], u'name': u'Dex'}, {u'displayMode': 1, u'values': [[u'95', 0]], u'name': u'Int'}], u'properties': [{u'displayMode': 0, u'values': [], u'name': u'Claw'}, {u'displayMode': 0, u'values': [[u'26-66', 1]], u'name': u'Physical Damage'}, {u'displayMode': 0, u'values': [[u'2-3', 4]], u'name': u'Elemental Damage'}, {u'displayMode': 0, u'values': [[u'6.00%', 0]], u'name': u'Critical Strike Chance'}, {u'displayMode': 0, u'values': [[u'1.60', 0]], u'name': u'Attacks per Second'}], u'icon': u'https://p7p4m6s5.ssl.hwcdn.net/image/Art/2DItems/Weapons/OneHandWeapons/Claws/Claw7.png?scale=1&w=2&h=2&v=3933dade22ef069ff0d05b1668c7002a3', 'count': 2, u'league': u'Tempest', u'name': u'Hypnotic Fist', u'_tab': 67, u'h': 2, u'identified': True, u'w': 2, u'_tab_label': u'39', u'y': 8, u'x': 6}, {u'socketedItems': [], u'corrupted': False, u'typeLine': u'Corsair Sword', u'implicitMods': [u'18% increased Accuracy Rating'], u'sockets': [{u'group': 0, u'attr': u'S'}], u'lockedToCharacter': False, u'verified': False, u'support': True, u'frameType': 2, u'explicitMods': [u'+26 to Strength', u'Adds 28-44 Fire Damage', u'Adds 2-3 Cold Damage', u'25% increased Critical Strike Chance'], u'_type': 0, u'_socketed': False, u'inventoryId': u'Stash71', u'requirements': [{u'displayMode': 0, u'values': [[u'58', 0]], u'name': u'Level'}, {u'displayMode': 1, u'values': [[u'81', 0]], u'name': u'Str'}, {u'displayMode': 1, u'values': [[u'117', 0]], u'name': u'Dex'}], u'properties': [{u'displayMode': 0, u'values': [], u'name': u'One Handed Sword'}, {u'displayMode': 0, u'values': [[u'16-63', 0]], u'name': u'Physical Damage'}, {u'displayMode': 0, u'values': [[u'28-44', 4], [u'2-3', 5]], u'name': u'Elemental Damage'}, {u'displayMode': 0, u'values': [[u'6.25%', 1]], u'name': u'Critical Strike Chance'}, {u'displayMode': 0, u'values': [[u'1.55', 0]], u'name': u'Attacks per Second'}], u'icon': u'https://p7p4m6s5.ssl.hwcdn.net/image/Art/2DItems/Weapons/OneHandWeapons/OneHandSwords/OneHandSword3.png?scale=1&w=1&h=3&v=0bf4b174a0c80b2fd80a12026ed04a053', 'count': 2, u'league': u'Tempest', u'name': u'Victory Bane', u'_tab': 70, u'h': 3, u'identified': True, u'w': 1, u'_tab_label': u'42', u'y': 6, u'x': 11}, {u'socketedItems': [], u'corrupted': False, u'typeLine': u'Loricated Ringmail', u'sockets': [{u'group': 0, u'attr': u'S'}, {u'group': 0, u'attr': u'S'}, {u'group': 1, u'attr': u'S'}], u'lockedToCharacter': False, u'verified': False, u'support': True, u'frameType': 2, u'explicitMods': [u'+328 to Armour', u'49% increased Armour and Energy Shield', u'+18% to Lightning Resistance', u'7% increased Stun Recovery'], u'_type': 0, u'_socketed': False, u'inventoryId': u'Stash73', u'requirements': [{u'displayMode': 0, u'values': [[u'58', 0]], u'name': u'Level'}, {u'displayMode': 1, u'values': [[u'84', 0]], u'name': u'Str'}, {u'displayMode': 1, u'values': [[u'84', 0]], u'name': u'Int'}], u'properties': [{u'displayMode': 0, u'values': [[u'834', 1]], u'name': u'Armour'}, {u'displayMode': 0, u'values': [[u'101', 1]], u'name': u'Energy Shield'}], u'icon': u'https://p7p4m6s5.ssl.hwcdn.net/image/Art/2DItems/Armours/BodyArmours/BodyStrInt1B.png?scale=1&w=2&h=3&v=e3ef9ff43db66e7bb9d49e26c1ead0233', 'count': 2, u'league': u'Tempest', u'name': u'Dragon Keep', u'_tab': 72, u'h': 3, u'identified': True, u'w': 2, u'_tab_label': u'44', u'y': 0, u'x': 8}, {u'socketedItems': [], u'corrupted': False, u'typeLine': u'Jewelled Foil', u'implicitMods': [u'20% increased Global Critical Strike Multiplier'], u'sockets': [{u'group': 0, u'attr': u'I'}, {u'group': 0, u'attr': u'D'}], u'lockedToCharacter': False, u'verified': False, u'support': True, u'frameType': 2, u'explicitMods': [u'Adds 4-76 Lightning Damage', u'+12% to Fire Resistance', u'0.4% of Physical Attack Damage Leeched as Mana', u'30% increased Stun Duration on Enemies'], u'_type': 0, u'_socketed': False, u'inventoryId': u'Stash74', u'requirements': [{u'displayMode': 0, u'values': [[u'68', 0]], u'name': u'Level'}, {u'displayMode': 1, u'values': [[u'212', 0]], u'name': u'Dex'}], u'properties': [{u'displayMode': 0, u'values': [], u'name': u'One Handed Sword'}, {u'displayMode': 0, u'values': [[u'27-51', 0]], u'name': u'Physical Damage'}, {u'displayMode': 0, u'values': [[u'4-76', 6]], u'name': u'Elemental Damage'}, {u'displayMode': 0, u'values': [[u'5.50%', 0]], u'name': u'Critical Strike Chance'}, {u'displayMode': 0, u'values': [[u'1.60', 0]], u'name': u'Attacks per Second'}], u'icon': u'https://p7p4m6s5.ssl.hwcdn.net/image/Art/2DItems/Weapons/OneHandWeapons/Rapiers/Rapier7.png?scale=1&w=1&h=4&v=d4a9ff1bbae62362d78bc8d5a44844463', 'count': 2, u'league': u'Tempest', u'name': u'Mind Impaler', u'_tab': 73, u'h': 4, u'identified': True, u'w': 1, u'_tab_label': u'45', u'y': 8, u'x': 5}, {u'socketedItems': [], u'corrupted': False, u'typeLine': u"Demon's Horn", u'implicitMods': [u'16% increased Spell Damage'], u'sockets': [{u'group': 0, u'attr': u'I'}, {u'group': 1, u'attr': u'I'}], u'lockedToCharacter': False, u'verified': False, u'support': True, u'frameType': 2, u'explicitMods': [u'Adds 24-48 Cold Damage to Spells', u'13% increased Global Critical Strike Multiplier', u'+26% to Lightning Resistance', u'+4 Life gained on Kill'], u'_type': 0, u'_socketed': False, u'inventoryId': u'Stash76', u'requirements': [{u'displayMode': 0, u'values': [[u'56', 0]], u'name': u'Level'}, {u'displayMode': 1, u'values': [[u'179', 0]], u'name': u'Int'}], u'properties': [{u'displayMode': 0, u'values': [], u'name': u'Wand'}, {u'displayMode': 0, u'values': [[u'26-48', 0]], u'name': u'Physical Damage'}, {u'displayMode': 0, u'values': [[u'8.00%', 0]], u'name': u'Critical Strike Chance'}, {u'displayMode': 0, u'values': [[u'1.20', 0]], u'name': u'Attacks per Second'}], u'icon': u'https://p7p4m6s5.ssl.hwcdn.net/image/Art/2DItems/Weapons/OneHandWeapons/Wands/Wand2.png?scale=1&w=1&h=3&v=dd4e9f9ef8b06e3f3e3fa3ba400f8ae83', 'count': 2, u'league': u'Tempest', u'name': u'Hate Barb', u'_tab': 75, u'h': 3, u'identified': True, u'w': 1, u'_tab_label': u'47', u'y': 9, u'x': 7}, {u'socketedItems': [], u'corrupted': False, u'typeLine': u'Abyssal Axe', u'sockets': [{u'group': 0, u'attr': u'D'}, {u'group': 0, u'attr': u'S'}, {u'group': 1, u'attr': u'S'}], u'lockedToCharacter': False, u'verified': False, u'support': True, u'frameType': 2, u'explicitMods': [u'+2 to Level of Socketed Melee Gems', u'+24 to Dexterity', u'Adds 16-25 Fire Damage', u'Adds 5-64 Lightning Damage', u'+33% to Lightning Resistance', u'18% reduced Attribute Requirements'], u'_type': 0, u'_socketed': False, u'inventoryId': u'Stash79', u'requirements': [{u'displayMode': 0, u'values': [[u'55', 0]], u'name': u'Level'}, {u'displayMode': 1, u'values': [[u'104', 1]], u'name': u'Str'}, {u'displayMode': 1, u'values': [[u'49', 1]], u'name': u'Dex'}], u'properties': [{u'displayMode': 0, u'values': [], u'name': u'Two Handed Axe'}, {u'displayMode': 0, u'values': [[u'69-104', 0]], u'name': u'Physical Damage'}, {u'displayMode': 0, u'values': [[u'16-25', 4], [u'5-64', 6]], u'name': u'Elemental Damage'}, {u'displayMode': 0, u'values': [[u'5.00%', 0]], u'name': u'Critical Strike Chance'}, {u'displayMode': 0, u'values': [[u'1.25', 0]], u'name': u'Attacks per Second'}], u'icon': u'https://p7p4m6s5.ssl.hwcdn.net/image/Art/2DItems/Weapons/TwoHandWeapons/TwoHandAxes/TwoHandAxe7.png?scale=1&w=2&h=4&v=b87f7cf114558ea0a1ac416fc6f919833', 'count': 2, u'league': u'Tempest', u'name': u'Victory Bane', u'_tab': 78, u'h': 4, u'identified': True, u'w': 2, u'_tab_label': u'50', u'y': 0, u'x': 4}, {u'socketedItems': [], u'corrupted': False, u'typeLine': u'Lacquered Garb', u'sockets': [{u'group': 0, u'attr': u'I'}, {u'group': 0, u'attr': u'I'}], u'lockedToCharacter': False, u'verified': False, u'support': True, u'frameType': 2, u'explicitMods': [u'+42 to Dexterity', u'+64 to maximum Life', u'+61 to maximum Mana', u'+7% to Chaos Resistance', u'12% increased Stun Recovery'], u'_type': 0, u'_socketed': False, u'inventoryId': u'Stash90', u'requirements': [{u'displayMode': 0, u'values': [[u'55', 0]], u'name': u'Level'}, {u'displayMode': 1, u'values': [[u'76', 0]], u'name': u'Dex'}, {u'displayMode': 1, u'values': [[u'76', 0]], u'name': u'Int'}], u'properties': [{u'displayMode': 0, u'values': [[u'204', 0]], u'name': u'Evasion Rating'}, {u'displayMode': 0, u'values': [[u'60', 0]], u'name': u'Energy Shield'}], u'icon': u'https://p7p4m6s5.ssl.hwcdn.net/image/Art/2DItems/Armours/BodyArmours/BodyDexInt2C.png?scale=1&w=2&h=3&v=a0e589c9975ee5fe5bc4845f9c81a5163', 'count': 2, u'league': u'Tempest', u'name': u'Dragon Keep', u'_tab': 89, u'h': 3, u'identified': True, u'w': 2, u'_tab_label': u'61', u'y': 4, u'x': 2}, {u'socketedItems': [], u'corrupted': False, u'typeLine': u'Titan Gauntlets', u'sockets': [{u'group': 0, u'attr': u'S'}, {u'group': 0, u'attr': u'S'}], u'lockedToCharacter': False, u'verified': False, u'support': True, u'frameType': 2, u'explicitMods': [u'Adds 4-8 Cold Damage to Attacks', u'+16 to Accuracy Rating', u'22% increased Armour', u'4 Life Regenerated per second', u'10% increased Rarity of Items found', u'9% increased Stun Recovery'], u'_type': 0, u'_socketed': False, u'inventoryId': u'Stash94', u'requirements': [{u'displayMode': 0, u'values': [[u'69', 0]], u'name': u'Level'}, {u'displayMode': 1, u'values': [[u'98', 0]], u'name': u'Str'}], u'properties': [{u'displayMode': 0, u'values': [[u'256', 1]], u'name': u'Armour'}], u'icon': u'https://p7p4m6s5.ssl.hwcdn.net/image/Art/2DItems/Armours/Gloves/GlovesStr4.png?scale=1&w=2&h=2&v=b2997b2df11d3b19cbb6a4c3054acda63', 'count': 2, u'league': u'Tempest', u'name': u'Hypnotic Fist', u'_tab': 93, u'h': 2, u'identified': True, u'w': 2, u'_tab_label': u'65', u'y': 0, u'x': 0}, {u'socketedItems': [], u'corrupted': False, u'typeLine': u'Primeval Rapier', u'implicitMods': [u'20% increased Global Critical Strike Multiplier'], u'sockets': [{u'group': 0, u'attr': u'D'}, {u'group': 0, u'attr': u'D'}, {u'group': 1, u'attr': u'D'}], u'lockedToCharacter': False, u'verified': False, u'support': True, u'frameType': 2, u'explicitMods': [u'Adds 10-19 Physical Damage', u'Adds 1-4 Fire Damage', u'11% increased Global Critical Strike Multiplier', u'+23% to Fire Resistance'], u'_type': 0, u'_socketed': False, u'inventoryId': u'Stash94', u'requirements': [{u'displayMode': 0, u'values': [[u'49', 0]], u'name': u'Level'}, {u'displayMode': 1, u'values': [[u'158', 0]], u'name': u'Dex'}], u'properties': [{u'displayMode': 0, u'values': [], u'name': u'One Handed Sword'}, {u'displayMode': 0, u'values': [[u'27-86', 1]], u'name': u'Physical Damage'}, {u'displayMode': 0, u'values': [[u'1-4', 4]], u'name': u'Elemental Damage'}, {u'displayMode': 0, u'values': [[u'6.50%', 0]], u'name': u'Critical Strike Chance'}, {u'displayMode': 0, u'values': [[u'1.30', 0]], u'name': u'Attacks per Second'}], u'icon': u'https://p7p4m6s5.ssl.hwcdn.net/image/Art/2DItems/Weapons/OneHandWeapons/Rapiers/Rapier6.png?scale=1&w=1&h=4&v=711d06ad04a80ad6442cbe1f940cbc513', 'count': 2, u'league': u'Tempest', u'name': u'Mind Impaler', u'_tab': 93, u'h': 4, u'identified': True, u'w': 1, u'_tab_label': u'65', u'y': 8, u'x': 5}]]
        if not self._app.inventories:
            return False
        self._app.lock.acquire()
        self.inventories = self._app.inventories[:]
        self._app.lock.release()

        self.tree_inventories.DeleteChildren(
            self.tree_inventories.GetRootItem())

        self.tree_inventories.inventoryids = []
        for i, inventory in enumerate(self.inventories, start = 1):
            _i = self.tree_inventories.AppendItem(self.tree_inventories.rootid,
                                                  "Inventory %s" % i)
            
            for item in inventory:
                self.tree_inventories.AppendItem(
                    _i, item["name"] + " [" + item["_tab_label"] + "]")

        self.tree_inventories.ExpandAll()

    def clear_previews(self):
        self.Freeze()
        for col in self.previews:
            for preview in col:
                preview["sizer"].StaticBox.SetLabel(" ")
                img.show_pygame_surf_in_wxBitmap(black, preview["bitmap"])
        self.Thaw()